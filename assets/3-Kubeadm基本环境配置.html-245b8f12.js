import{_ as a,p as s,q as e,a1 as n}from"./framework-5866ffd3.js";const i={},r=n(`<h1 id="kubeadm基本环境配置" tabindex="-1"><a class="header-anchor" href="#kubeadm基本环境配置" aria-hidden="true">#</a> Kubeadm基本环境配置</h1><h2 id="所有节点配置hosts-修改-etc-hosts-如下" tabindex="-1"><a class="header-anchor" href="#所有节点配置hosts-修改-etc-hosts-如下" aria-hidden="true">#</a> 所有节点配置hosts，修改<code>/etc/hosts</code> 如下</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> /etc/hosts
<span class="token number">192.168</span>.12.10 k8s-master01
<span class="token number">192.168</span>.12.11 k8a-master02
<span class="token number">192.168</span>.0.200 k8s-master-lb
<span class="token number">192.168</span>.12.12 k8s-node01
<span class="token number">192.168</span>.12.13 k8s-node02
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="yum源配置" tabindex="-1"><a class="header-anchor" href="#yum源配置" aria-hidden="true">#</a> yum源配置</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-o</span> /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/yum.repos.d/kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;/mirrors.cloud.aliyuncs.com/d&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;/mirrors.aliyuncs.com/d&#39;</span> /etc/yum.repos.d/CentOS-Base.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="必备工具安装" tabindex="-1"><a class="header-anchor" href="#必备工具安装" aria-hidden="true">#</a> 必备工具安装</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token function">wget</span> jq psmisc <span class="token function">vim</span> net-tools telnet yum-utils device-mapper-persistent-data lvm2 <span class="token function">git</span> <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="所有节点关闭防火墙、selinux、dnsmasq、swap。服务器配置如下" tabindex="-1"><a class="header-anchor" href="#所有节点关闭防火墙、selinux、dnsmasq、swap。服务器配置如下" aria-hidden="true">#</a> 所有节点关闭防火墙、selinux、dnsmasq、swap。服务器配置如下</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl disable <span class="token parameter variable">--now</span> firewalld 
systemctl disable <span class="token parameter variable">--now</span> dnsmasq
systemctl disable <span class="token parameter variable">--now</span> NetworkManager

setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39;</span> /etc/sysconfig/selinux
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39;</span> /etc/selinux/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="关闭swap分区" tabindex="-1"><a class="header-anchor" href="#关闭swap分区" aria-hidden="true">#</a> 关闭swap分区</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>swapoff <span class="token parameter variable">-a</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.swappiness</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">&#39;/^[^#]*swap/s@^@#@&#39;</span> /etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装ntpdate" tabindex="-1"><a class="header-anchor" href="#安装ntpdate" aria-hidden="true">#</a> 安装ntpdate</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm
yum <span class="token function">install</span> ntpdate <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="所有节点同步时间。时间同步配置如下" tabindex="-1"><a class="header-anchor" href="#所有节点同步时间。时间同步配置如下" aria-hidden="true">#</a> 所有节点同步时间。时间同步配置如下</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
<span class="token builtin class-name">echo</span> <span class="token string">&#39;Asia/Shanghai&#39;</span> <span class="token operator">&gt;</span>/etc/timezone
ntpdate time2.aliyun.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="加入到crontab" tabindex="-1"><a class="header-anchor" href="#加入到crontab" aria-hidden="true">#</a> 加入到crontab</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">crontab</span> <span class="token parameter variable">-e</span> <span class="token comment"># 开机自启动</span>
*/5 * * * * ntpdate time2.aliyun.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="所有节点配置limit" tabindex="-1"><a class="header-anchor" href="#所有节点配置limit" aria-hidden="true">#</a> 所有节点配置limit</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-SHn</span> <span class="token number">65535</span>

<span class="token function">vim</span> /etc/security/limits.conf
<span class="token comment"># 末尾添加如下内容</span>
* soft nofile <span class="token number">655360</span>
* hard nofile <span class="token number">131072</span>
* soft nproc <span class="token number">655350</span>
* hard nproc <span class="token number">655350</span>
* soft memlock unlimited
* hard memlock unlimited
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="master01节点免密钥登录其他节点" tabindex="-1"><a class="header-anchor" href="#master01节点免密钥登录其他节点" aria-hidden="true">#</a> Master01节点免密钥登录其他节点</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ssh-keygen <span class="token parameter variable">-t</span> rsa
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> k8s-master01 k8s-master02 k8s-node01 k8s-node02<span class="token punctuation">;</span><span class="token keyword">do</span> ssh-copy-id <span class="token parameter variable">-i</span> .ssh/id_rsa.pub <span class="token variable">$i</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="下载安装所有的源码文件" tabindex="-1"><a class="header-anchor" href="#下载安装所有的源码文件" aria-hidden="true">#</a> 下载安装所有的源码文件</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /root/ <span class="token punctuation">;</span> <span class="token function">git</span> clone https://github.com/dotbalo/k8s-ha-install.git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="所有节点升级系统并重启" tabindex="-1"><a class="header-anchor" href="#所有节点升级系统并重启" aria-hidden="true">#</a> 所有节点升级系统并重启</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum update <span class="token parameter variable">-y</span>  <span class="token operator">&amp;&amp;</span> <span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,25),l=[r];function t(d,c){return s(),e("div",null,l)}const p=a(i,[["render",t],["__file","3-Kubeadm基本环境配置.html.vue"]]);export{p as default};
