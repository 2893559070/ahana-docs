import{_ as i,r as l,o as d,c as r,b as s,d as e,e as c,a as n}from"./app-676abf65.js";const o={},p=s("h1",{id:"kubeadm高可用安装基本说明",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#kubeadm高可用安装基本说明","aria-hidden":"true"},"#"),e(" Kubeadm高可用安装基本说明")],-1),m=s("h2",{id:"_1基本环境配置",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1基本环境配置","aria-hidden":"true"},"#"),e(" 1基本环境配置")],-1),u=["src"],b={href:"https://kubermetes.ioldocs/setup/",target:"_blank",rel:"noopener noreferrer"},v=n(`<p><a href="https:/kubernetes.io/ldocs/setup/production-environment/tools/kubeadm/high-availability">最新版︰高可用安装</a></p><ol><li>Kubectl debug设置一个临时容器</li><li>Sidecar</li><li>volume。更改目录权限，fsSroups</li><li>ConfigMap_和 Secretc</li></ol><h3 id="高可用kubernetes集群规划表" tabindex="-1"><a class="header-anchor" href="#高可用kubernetes集群规划表" aria-hidden="true">#</a> 高可用Kubernetes集群规划表</h3><table><thead><tr><th>主机多</th><th>P地址</th><th>说明</th></tr></thead><tbody><tr><td>k8s-master</td><td>192.168.1.18~20</td><td>mastex.节点*3</td></tr><tr><td>k8s-master-lb</td><td>192.168.1.100</td><td>kespalved.虚拟ip</td></tr><tr><td>k8s-node01 ~02</td><td>192.168.1.21~22</td><td>worker.节点*2</td></tr></tbody></table><ul><li>所有节点配置hosts，修改<code>/etc/hosts</code> 如下</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> /etc/hosts
<span class="token number">192.168</span>.12.10 k8s-master01
<span class="token number">192.168</span>.12.11 k8a-master02
<span class="token number">192.168</span>.0.200 k8s-master-lb
<span class="token number">192.168</span>.12.12 k8s-node01
<span class="token number">192.168</span>.12.13 k8s-node02
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),h=["src"],k=n(`<ul><li>所有节点关闭防火墙、selinux、dnsmasg、swap。服务器配置如下</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl disable <span class="token parameter variable">--now</span> firewalld
systemctl disable <span class="token parameter variable">--now</span> dnsmasg
systemctl disable <span class="token parameter variable">--now</span> NetworkManager <span class="token comment"># CentOS8无需关闭</span>
setenforce <span class="token number">0</span>

<span class="token function">vim</span> /etc/sysconfig/selinux <span class="token comment"># 修改 SELINUX=disabled</span>

swapoff <span class="token parameter variable">-a</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.swappiness</span><span class="token operator">=</span><span class="token number">0</span> <span class="token comment"># 开启会影响k8s性能，所以关闭</span>

<span class="token function">vim</span> /etc/fstab  <span class="token comment"># 注释带有swap的  /dev/mapper/cl-swap</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将服务器时区同步" tabindex="-1"><a class="header-anchor" href="#将服务器时区同步" aria-hidden="true">#</a> 将服务器时区同步</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ntpdate time2.aliyun.com <span class="token comment"># 设置时间服务器</span>

<span class="token function">crontab</span> <span class="token parameter variable">-e</span> <span class="token comment"># 开机自启动</span>
  */5 * * * * ntpdate time2.aliyun.com <span class="token comment"># 5分钟更新下时间</span>

/etc/rc.local <span class="token comment"># 加入到开机自动同步</span>
  ntpdate time2.aliyun.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="所有节点设置ulimit" tabindex="-1"><a class="header-anchor" href="#所有节点设置ulimit" aria-hidden="true">#</a> 所有节点设置ulimit</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-SHn</span> <span class="token number">65535</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="密钥配置" tabindex="-1"><a class="header-anchor" href="#密钥配置" aria-hidden="true">#</a> 密钥配置</h3><p>Master01节点免密钥登录其他节点,安装过程中生成配置文件和证书均在 Master01上操作，集群管理也在Master01上操作，阿里云或者AWS上需要单独一台kubectl服务器。密钥配置如下:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ssh-keygen <span class="token parameter variable">-t</span> rsa

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> k8s-master01 k8s-master02 k8s-node01 k8s-node02<span class="token punctuation">;</span> <span class="token keyword">do</span> ssh-copy-id <span class="token parameter variable">-i</span> .ssh/id_rsa.pub <span class="token variable">$i</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9);function _(a,f){const t=l("ExternalLinkIcon");return d(),r("div",null,[p,m,s("img",{src:a.$withBase("/k8s/安装/1.png"),alt:"foo"},null,8,u),s("p",null,[s("a",b,[e("K8S官网"),c(t)])]),v,s("img",{src:a.$withBase("/k8s/安装/2.png"),alt:"foo"},null,8,h),k])}const w=i(o,[["render",_],["__file","1-Kubeadm高可用安装基本说明.html.vue"]]);export{w as default};
